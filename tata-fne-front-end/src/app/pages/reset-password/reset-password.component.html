<div class="login-page">
  <section class="form-panel">
    <div class="form-card">
      <div class="form-logo">
        <img src="/logo.png" alt="Tata logo" />
      </div>

      <div class="headline">
        <p class="eyebrow">Réinitialisation de mot de passe</p>
        <h1>Nouveau mot de passe</h1>
        <p class="lede">Entrez votre token et votre nouveau mot de passe.</p>
      </div>

      @if (successMessage()) {
        <div class="success-message">
          <div class="success-icon">✓</div>
          <h2>{{ successMessage() }}</h2>
          <p>Vous allez être redirigé vers la page de connexion.</p>
        </div>
      } @else {
        <form [formGroup]="resetPasswordForm" (ngSubmit)="submit()" novalidate>
          <label class="field-label" for="otp">Code de sécurité *</label>
          <div class="otp-container">
            @for (digit of otp; track $index) {
              <input
                id="otp-{{ $index }}"
                type="text"
                maxlength="1"
                inputmode="numeric"
                pattern="[0-9]"
                [value]="digit"
                (input)="onOtpChange($index, $event)"
                (paste)="onOtpPaste($event)"
                class="otp-input"
                autocomplete="one-time-code"
              />
            }
          </div>

          <label class="field-label" for="newPassword">Nouveau mot de passe *</label>
          <div class="field password-field" [class.invalid]="resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched">
            <input
              id="newPassword"
              [type]="showPassword ? 'text' : 'password'"
              formControlName="newPassword"
              placeholder="Nouveau mot de passe"
              autocomplete="new-password"
            />
            <button type="button" class="toggle" (click)="togglePassword()">
              {{ showPassword ? 'Masquer' : 'Afficher' }}
            </button>
          </div>

          <label class="field-label" for="confirmPassword">Confirmer le mot de passe *</label>
          <div class="field password-field" [class.invalid]="resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched">
            <input
              id="confirmPassword"
              [type]="showConfirmPassword ? 'text' : 'password'"
              formControlName="confirmPassword"
              placeholder="Confirmez le mot de passe"
              autocomplete="new-password"
            />
            <button type="button" class="toggle" (click)="toggleConfirmPassword()">
              {{ showConfirmPassword ? 'Masquer' : 'Afficher' }}
            </button>
          </div>

          @if (errorMessage()) {
            <div class="error">
              {{ errorMessage() }}
            </div>
          }

          <button class="primary" type="submit" [disabled]="submitting()">
            {{ submitting() ? 'Réinitialisation en cours...' : 'Réinitialiser le mot de passe' }}
          </button>

          <p class="hint">Le code est valable 15 minutes.</p>
        </form>
      }

      <div class="actions">
        <a routerLink="/forgot-password" class="link">Retour à la demande de réinitialisation</a>
      </div>
    </div>
  </section>
</div>